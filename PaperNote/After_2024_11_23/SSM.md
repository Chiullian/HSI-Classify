# SSM 状态空间模型

状态空间表示:
* 当前的状态(current state)
* 隐藏的状态
* 未来可能的状态
* 哪些变化能将你带到下一个状态
* ...

什么是状态空间模型 ?
- 是用于描述上面这些状态表示并根据某些输入预测其下一个状态可能是什么的模型


举个例子:
![](https://image.chiullian.cn/img/202410291433371.png)


而上述迷宫可以简化建模为一个“状态空间表示state space representation”，每一个小框显示

- 你当前所在的位置(当前状态current state)
- 下一步可以去哪里(未来可能的状态possible future states)
- 以及哪些变化会将你带到下一个状态(向右或向左)

> 每种状态都可以用一个向量去表示

RNN就是一种SSM模型

一般SSMs包括以下组成:
* 映射输入序列x(t)，比如在迷宫中向左和向下移动
* 到潜在状态表示h(t)，比如距离出口距离和 x, y 坐标
* 并导出预测输出序列y(t)，比如再次向左移动以更快到达出口

![](https://image.chiullian.cn/img/202410291437300.png)

#### SSM 状态公式解释

*上面这个公式就是SSM 最重要的部分了* 
> 其中A矩阵乘 的 `h(t)` 与 C 矩阵乘的 `h(t)` 是同一个, 代表上一层过来的隐藏状态(附带了历史的信息),
> h(t) 在状态方程和输出方程中是同一个变量，表示系统当前时刻的状态。
矩阵 A 和 C 的不同作用决定了它们对 h(t) 的使用方式不同：A 描述状态的动态演化。C 描述状态如何映射到系统的输出。
> 
> 而 `h'(t)` 是用来 是状态的变化率，描述系统在当前时刻状态如何变化。
> 状态 `(t)` 是系统在某一时刻的完整描述，用于预测未来。而状态导数 `h˙(t)`是状态的变化趋势，它只是系统动态方程的一部分。

h(t) 是如何更新的:

![](https://image.chiullian.cn/img/202411251423389.png)

上面的第一个方程是不是和RNN循环结构：

非常类似？——通过上一个隐藏状态和当前输入综合得到当前的隐藏状态，只是两个权重W、U换成了A、B两个系数，且去掉了非线性的激活函数tanh
但系数A代表着什么，这点其实非常关键，然我看过的几乎所有讲解SSM/S4/mamba的文章都没有一针见血的指出来，
***其实A就是存储着之前所有历史信息的浓缩精华(可以通过一系列系数组成的矩阵表示之)，以基于A更新下一个时刻的空间状态hidden state***

> 总之，SSM的关键是找到：状态表示(state representation) H(t)

------------

然后上面是时间连续的定义: 所以我们要引入离散的概念来处理文本等一系列信息
#### 离散话时间序列信息:
SSM的离散形式:

![](https://image.chiullian.cn/img/202411251434549.png)

`Ad` 和 `Bd` 是离散化后的系统矩阵，描述离散时间下系统状态和输入的演化关系。
通过对这两个矩阵进行离散化，可以在离散时间步 k 之间，正确捕捉状态 x[k] 和输入 u[k] 的作用关系。

![](https://image.chiullian.cn/img/202411251433843.png)

> 如果将上面的输出多嵌套几层就会发现 :
> 
![](https://image.chiullian.cn/img/202411251440649.png)

> 通过上面的嵌套的3次公式来看, 当长度固定的时候所需要训练的矩阵是确定的, C与Xi中间夹的矩阵

####  也可以说最大的优化是通过卷积实现了并行化

这就可以联想到卷积核了:

![](https://image.chiullian.cn/img/202411251450721.png)


![](https://image.chiullian.cn/img/202411251450834.png)

进行卷积的具体步骤:

![](https://image.chiullian.cn/img/202411251451282.png)

![](https://image.chiullian.cn/img/202411251452012.png)

![](https://image.chiullian.cn/img/202411251454437.png)

#### 训练的模式

考虑到 RNN 训练速度较慢 推理速度较快, 而CNN 训练速度较快,推理依赖卷积核较慢, 所以综合了他俩的优点:

![](https://image.chiullian.cn/img/202411251502531.png)

#### SSM 总结成一句话就是 `CNN` 化的 `RNN`
### 为什么 `SSM`  能 压缩记录历史的所有信息 ？ !!!!!!!!!!!!!!!!!!!!!!!
##### 长距离依赖问题的解决之道——HiPPO

> 比如现在你还能回想起小时候发生的比较重要的事情, 而传统的h  记不了这么远

状态空间模型（SSM）通过状态方程的导数（即 h˙(t) 或离散化后的增量 Δh(t)）来动态记录和更新历史信息，而不是直接保存完整的历史输入数据
。这种做法实际上是将历史信息转化为一种动态的递归关系，通过数学模型对过去的输入和状态进行压缩表示

HiPPO 矩阵通常用于将连续时间信号投影到正交多项式基下，以代表过去的状态/信息

![](https://image.chiullian.cn/img/202411251717680.png)

![](https://image.chiullian.cn/img/202411251720090.png)

### 