# WFCG

架构简述:

> 在分支中，为了获得稳定的超像素级特征，我们使用多头GAT和归一化层来提取超像素级特征，
> 并通过图形编码器和解码器实现它们之间的连接。在分支二中，将处理后的像素级光谱特征与关注模块结合，传递到CNN中，捕获远程深度特征。最后，对两个分支得到的特征进行加权融合


![](https://image.chiullian.cn/img/202411141304034.png)

(上图的(b)的黑框是超像素的划分)

实验表明 使用GAT虽然说他使用较小的训练比例就能获取较好的效果(上限不高), 但是当训练比例增加时CNN的效果增加显著,而GAT上升的很缓慢

然后他就找到了创新点, 由于他俩对样本量敏感度的感觉是不同的
* CNN对像素的敏感度需要较多的样本
* 超像素分割方法本身存在一定的误差，当训练样本变多时,限制了分割精度的进一步提高。

所以提出一种融合:
充分发挥各自的优点,各自弥补对方的不足:

困难点:
* GNN提取的特征分布与CNN不同。直接应用CNN和GNN特征相加或拼接可能无法获得最佳的分类性能。

WFCG 就是解决了这个困难点:

#### 模型整体架构图:

![](https://image.chiullian.cn/img/202411141314894.png)

> 首先对图进行1*1卷积的夸信道交互,去除无用的频谱信息,(因为原图中会有噪声和冗余信息)
> 同时可以作为降维模块, 能增加网络的深度, 增加性能和分类精度 


## batch one

#### 重要优化问题

样本数量较少的时候使用过多2D卷积会有过拟合现象, 可使用深度可分离卷积减少过拟合

超像素和像素之间的对应关系:

![](https://image.chiullian.cn/img/202411141418050.png)

> 使用SLIC超像素分割算法将图像分割成多个超像素。然后，构建一个关联矩阵O，用于表示像素与超像素之间的关系。如果像素i属于超像素j，则O的元素O_ij为1，否则为0

![](https://image.chiullian.cn/img/202411141422462.png)

解释: O的转置乘Flatten(X)  的含义 也就是Encoder层的作用:

* 将像素特征转换为超像素特征的关键步骤
* ***将O的转置与Flatten(X) 相乘，实际上是对每个超像素内的像素特征进行加权平均，权重为像素属于该超像素的概率***

!!!!!!!!!!
#### 非常好的特征聚合
>  该操作将多个像素特征聚合为一个超像素特征，从而保留了像素之间的空间关系，并提取了超像素级别的特征信息。
> 
> `将像素特征转换为超像素特征，为GNN处理图像数据提供了可能。`


然后Encoder后的形状为 V (超像素的数量*1), V[j] 就是 超像素j块的像素特征平均值 !!!!!!!! `为什么不可以加个内部注意力模块`
下面可以引进图了: 每个节点就是超像素的值(也就是属于该超像素的像素的平均特征值)

下面就是图注意力模块GAT

## batch two

卷积模块:

![](https://image.chiullian.cn/img/202411141502099.png)


卷积模块:
位置注意力模块和通道注意力模块。这两个模块分别用于增强局部特征和通道特征的表达能力，从而提高模型的分类性能。

位置注意力模块:
* 非线性变换: 首先，使用卷积层对输入的局部特征进行非线性变换，生成两个新的特征图A和B。
* 矩阵乘法: 将A的转置与B相乘，得到一个矩阵MP，其中每个元素mpji表示位置i对位置j的影响程度。
* Softmax: 使用Softmax函数对矩阵MP进行归一化，得到位置注意力图。注意力图中的值在0到1之间，表示每个位置的重要性。
* 加权求和: 将位置注意力图与另一个特征图C相乘，并将结果与输入特征进行元素级求和，得到最终的输出特征。

通道注意力模块:
* 计算通道注意力图: 直接对输入特征进行矩阵乘法，得到一个矩阵MC，其中每个元素mcji表示通道i对通道j的影响程度。
* Softmax: 使用Softmax函数对矩阵MC进行归一化，得到通道注意力图。
* 加权求和: 将通道注意力图与输入特征相乘，并将结果与输入特征进行元素级求和，得到最终的输出特征。

位置: 更好的体现了各个位置之间关系,能够更好地编码更广泛的上下文信息，增强局部特征的表达能力。
通道注意力模块: 重点关注不同通道之间的相关性，能够突出相互依赖的特征图，并提高特定语义的特征表示。

> 同时还引入的残差获取最初的位置关系, 即保留原始信息的同时又突出重要信息

## 融合模块

![](https://image.chiullian.cn/img/202411141506847.png)

引入超参数融合系数 
这样就能自适应的变换, 在某些情况下哪一个模块的重要性就越高

> 该模型能很好的使用到大数据集上面


![](https://image.chiullian.cn/img/202411141509085.png)

用极少的数据获取到了更大的精度

